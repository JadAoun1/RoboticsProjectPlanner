{% extends 'base.html' %}`r`n`r`n{% block title %} {% if form.instance.pk %}Edit Note{%
else %}Add Note{% endif %} - {{ project.project_name }} - RoboPlanner {%
endblock %}`r`n`r`n{% block content %}
<div class="form-container" style="max-width: 700px; margin: 0 auto">
  <!-- Breadcrumb Navigation -->
  <nav aria-label="breadcrumb" class="mb-3">
    <div class="breadcrumb text-sm text-muted">
      <a href="{% url 'projects:dashboard' %}" class="text-primary"
        >My Projects</a
      >
      <span class="mx-2">‚Ä∫</span>
      <a href="{% url 'projects:detail' project.pk %}" class="text-primary"
        >{{ project.project_name }}</a
      >
      <span class="mx-2">‚Ä∫</span>
      <span
        >{% if form.instance.pk %}Edit Note{% else %}Add Note{% endif %}</span
      >
    </div>
  </nav>

  <div class="card">
    <div class="card-header">
      <h1 class="card-title">
        <span aria-hidden="true">üìù</span>
        {% if form.instance.pk %}
        <span class="text-primary">Edit Note</span>
        {% else %}
        <span class="text-primary">Add New Note</span>
        {% endif %}
      </h1>
      <p class="text-muted">
        {% if form.instance.pk %} Update your project documentation {% else %}
        Document ideas, progress, or important details {% endif %}
      </p>
    </div>

    <div class="card-body">
      <form method="post" novalidate>
        {% csrf_token %} {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
          {% for error in form.non_field_errors %}
          <p>{{ error }}</p>
          {% endfor %}
        </div>
        {% endif %}

        <div class="form-group">
          <label for="{{ form.title.id_for_label }}" class="form-label">
            Note Title
          </label>
          {{ form.title }} {% if form.title.errors %}
          <div class="text-danger mt-1" role="alert">
            {% for error in form.title.errors %}
            <small>{{ error }}</small>
            {% endfor %}
          </div>
          {% endif %}
          <small class="text-muted">
            Give your note a descriptive title (e.g., "Initial Design Ideas",
            "Testing Results")
          </small>
        </div>

        <div class="form-group">
          <label for="{{ form.content.id_for_label }}" class="form-label">
            Content <span class="text-danger" aria-label="required">*</span>
          </label>
          {{ form.content }} {% if form.content.errors %}
          <div class="text-danger mt-1" role="alert">
            {% for error in form.content.errors %}
            <small>{{ error }}</small>
            {% endfor %}
          </div>
          {% endif %}
          <small class="text-muted">
            Write detailed notes, observations, or documentation for your
            project
          </small>
        </div>

        <!-- Note Templates -->
        <div
          class="note-templates card"
          style="background: #f0f9ff; border-color: #bfdbfe; margin: 1.5rem 0"
        >
          <div class="card-body">
            <h3 class="text-primary mb-2">üìã Note Templates</h3>
            <p class="text-sm text-muted mb-3">
              Click to use a template structure:
            </p>
            <div class="templates-grid grid grid-2" style="gap: 0.75rem">
              <button
                type="button"
                class="template-btn btn btn-outline btn-sm"
                data-template="progress"
              >
                Progress Update
              </button>
              <button
                type="button"
                class="template-btn btn btn-outline btn-sm"
                data-template="testing"
              >
                Testing Results
              </button>
              <button
                type="button"
                class="template-btn btn btn-outline btn-sm"
                data-template="ideas"
              >
                Design Ideas
              </button>
              <button
                type="button"
                class="template-btn btn btn-outline btn-sm"
                data-template="troubleshoot"
              >
                Troubleshooting
              </button>
            </div>
          </div>
        </div>

        <div class="form-actions flex gap-2 mt-4">
          <button type="submit" class="btn btn-primary">
            {% if form.instance.pk %}
            <span aria-hidden="true">üíæ</span> Update Note {% else %}
            <span aria-hidden="true">üìù</span> Save Note {% endif %}
          </button>

          <a
            href="{% url 'projects:detail' project.pk %}"
            class="btn btn-outline"
          >
            Cancel
          </a>
        </div>
      </form>
    </div>
  </div>

  <!-- Writing Tips -->
  <div class="writing-tips mt-4">
    <div class="card" style="background: #f0fdf4; border-color: #bbf7d0">
      <div class="card-body">
        <h3 class="text-secondary mb-2">‚úèÔ∏è Writing Tips</h3>
        <div class="tips-grid grid grid-2" style="gap: 1rem">
          <div>
            <strong class="text-sm">Be Specific</strong>
            <p class="text-sm text-muted">
              Include exact measurements, part numbers, and settings
            </p>
          </div>
          <div>
            <strong class="text-sm">Document Problems</strong>
            <p class="text-sm text-muted">
              Note what didn't work and why - it's valuable!
            </p>
          </div>
          <div>
            <strong class="text-sm">Include Context</strong>
            <p class="text-sm text-muted">
              Explain what you were trying to achieve
            </p>
          </div>
          <div>
            <strong class="text-sm">Future Self</strong>
            <p class="text-sm text-muted">
              Write for someone who doesn't remember this work
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}`r`n`r`n{% block extra_head %}
<style>
  .breadcrumb {
    padding: 0.75rem 0;
  }

  .form-actions {
    border-top: 1px solid var(--border);
    padding-top: 1.5rem;
    margin-top: 1.5rem;
  }

  .template-btn {
    justify-content: flex-start;
    text-align: left;
  }

  .templates-grid button {
    white-space: nowrap;
  }

  .tips-grid > div {
    padding: 0.75rem;
    background: var(--surface);
    border-radius: 0.375rem;
    border: 1px solid var(--border);
  }

  textarea {
    min-height: 200px;
    resize: vertical;
  }

  @media (max-width: 768px) {
    .form-actions {
      flex-direction: column;
    }

    .form-actions .btn {
      justify-content: center;
    }

    .templates-grid {
      grid-template-columns: 1fr;
    }

    .tips-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}`r`n`r`n{% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const contentTextarea = document.getElementById(
      "{{ form.content.id_for_label }}"
    );
    const titleInput = document.getElementById("{{ form.title.id_for_label }}");

    const templates = {
      progress: {
        title: "Progress Update - {{ project.project_name }}",
        content: `## What I accomplished today:
- 

## Current status:
- 

## Next steps:
- 

## Issues encountered:
- 

## Notes:
- `,
      },
      testing: {
        title: "Testing Results - {{ project.project_name }}",
        content: `## Test objective:


## Test setup:
- 

## Results:
- Expected: 
- Actual: 

## Observations:
- 

## Conclusions:
- 

## Next actions:
- `,
      },
      ideas: {
        title: "Design Ideas - {{ project.project_name }}",
        content: `## Problem to solve:


## Possible approaches:
1. 
2. 
3. 

## Pros and cons:
### Option 1:
- Pros: 
- Cons: 

## Resources needed:
- 

## Decision:
- `,
      },
      troubleshoot: {
        title: "Troubleshooting - {{ project.project_name }}",
        content: `## Problem description:


## When it occurs:
- 

## What I've tried:
1. 
2. 
3. 

## Observations:
- 

## Possible causes:
- 

## Solution:
- 

## Prevention:
- `,
      },
    };

    document.querySelectorAll(".template-btn").forEach((button) => {
      button.addEventListener("click", function () {
        const templateType = this.dataset.template;
        const template = templates[templateType];

        if (template) {
          if (!titleInput.value || titleInput.value === "Note") {
            titleInput.value = template.title;
          }
          contentTextarea.value = template.content;
          contentTextarea.focus();
        }
      });
    });
  });
</script>
{% endblock %}

